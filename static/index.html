<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>

<body>


    <div class="container mt-5">
        <div class="row">
            <div class="col-md-4">
                <label for="select1">Marque:</label>
                <select class="form-control" id="select1">
                </select>
            </div>

            <div class="col-md-4">
                <label for="select2">Mod√®le:</label>
                <select class="form-control" id="select2">
                </select>
            </div>

            <div class="col-md-4">
                <label for="select3">Carosserie:</label>
                <select class="form-control" id="select3">
                </select>
            </div>
        </div>
    </div>

    <script>
        function fillSelectOptions(selectorId, options) {
            var select = document.getElementById(selectorId);

            while (select.firstChild) {
                select.removeChild(select.firstChild);
            }

            options.forEach(option => {
                var opt = document.createElement('option');
                opt.value = option.id;
                opt.textContent = option.Marque;
                select.appendChild(opt);
            });
        }


        function updateSelect2() {
            var select1Value = document.getElementById('select1').value;
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/options/' + select1Value);

            xhr.onload = function() {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);

                    console.log(xhr.responseText)
                    console.log(response)
                    const select = document.getElementById('select2');
                    select.innerHTML = '';
                    response.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.id;
                        opt.textContent = option.Model;
                        select.appendChild(opt);
                    });

                }
            }

            xhr.send();
        }

        function updateSelect3() {
            var select1Value = document.getElementById('select1').value;
            var select2Value = document.getElementById('select2').value;
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/options/' + select1Value + '/' + select2Value);

            xhr.onload = function() {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);

                    console.log(xhr.responseText)
                    console.log(response)
                    const select = document.getElementById('select3');
                    select.innerHTML = '';
                    response.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.id;
                        opt.textContent = option.Carosserie;
                        select.appendChild(opt);
                    });

                }
            }

            xhr.send();
        }


        fetch("/api/options")
            .then(response => response.json())
            .then(data => {

                fillSelectOptions('select1', data);

                document.getElementById('select1').addEventListener('change', updateSelect2);
                document.getElementById('select2').addEventListener('change', updateSelect3);
            })
            .catch(error => console.error('Erreur:', error));
    </script>

</body>

</html>